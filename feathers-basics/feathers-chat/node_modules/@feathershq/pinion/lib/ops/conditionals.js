"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.when = void 0;
const core_1 = require("../core");
const helpers_1 = require("./helpers");
/**
 * Conditionally run an operation
 *
 * @param condition The condition to evaluate
 * @param operation The operation to run when the condition is true
 * @returns The updated context
 */
const when = (condition, ...operations) => async (ctx) => {
    const value = await (0, core_1.getCallable)(condition, ctx);
    const result = value
        ? await operations.reduce((current, op) => current.then(op), Promise.resolve(ctx))
        : ctx;
    return (0, helpers_1.addTrace)(result, 'when', { value });
};
exports.when = when;
