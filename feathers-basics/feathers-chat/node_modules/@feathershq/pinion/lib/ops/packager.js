"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.install = void 0;
const core_1 = require("../core");
const helpers_1 = require("./helpers");
const install = (dependencies, dev = false, packager = 'npm') => async (ctx) => {
    const dependencyList = await (0, core_1.getCallable)(dependencies, ctx);
    const packageManager = await (0, core_1.getCallable)(packager, ctx);
    const subCommand = packageManager === 'yarn' ? 'add' : 'install';
    const flags = packageManager === 'yarn' ? (dev ? ['-D'] : []) : dev ? ['--save-dev'] : ['--save'];
    ctx.pinion.logger.warn(`Running ${packageManager} ${subCommand} ${flags.join(' ')}`);
    const exitCode = await ctx.pinion.exec(packageManager, [subCommand, ...flags, ...dependencyList], {
        cwd: ctx.cwd
    });
    if (exitCode !== 0) {
        throw new Error(`Package manager ${packageManager} exited with error code ${exitCode}`);
    }
    return (0, helpers_1.addTrace)(ctx, 'install', { packageManager, subCommand, flags, dependencyList });
};
exports.install = install;
